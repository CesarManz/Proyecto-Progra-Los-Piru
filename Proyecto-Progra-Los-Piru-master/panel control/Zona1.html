<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zona 1</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<!-- Menu Desplegable de las zonas-->
<div id="header">
  <ul class="nav">
    <li><a href="index.html">Zonas</a>
      <ul>
        <li><a href="Zona1.html">Zona #1</a></li>
        <li><a href="Zona2.html">Zona #2</a></li>
        <li><a href="Zona3.html">Zona #3</a></li>
      </ul>
    </li>
  </ul>
</div>

<!--Zona y boton exportar datos-->
<div class="cabecera">
  <h2 class="TituloZona">Zona #1</h2>
  <button onclick="exportarDatos()" class="botonExportar">Exportar Datos</button>
</div>

<!-- Datos -->
<h2 class="DatosSensor">Datos del Sensor</h2>
<button onclick="cargarDatos()">Cargar Datos</button>
<ul id="listaDatos"></ul>

<h3>Modificar un valor:</h3>
<label for="idSensor">ID del Sensor:</label>
<input type="number" id="idSensor" placeholder="ID del sensor">
<label for="nuevoValor">Nuevo valor:</label>
<input type="number" id="nuevoValor" placeholder="Nuevo valor">
<button onclick="modificarValor()">Modificar Valor</button>


<script>
  let datosSensor = [];

  /*
  *Exportar los datos modificados en un .json
   */
  function exportarDatos(){
    const blob = new Blob([JSON.stringify({ datos: datosSensor }, null, 2)], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'datos_sensor.csv';
    link.click();
  }
  /*
  *Cargar datos desde el archivo JSON
   */
  function cargarDatos() {
    fetch('datos_sensor.json')
      .then(response => response.json())
      .then(data => {
        datosSensor = data.datos;
        mostrarDatos();
      })
      .catch(error => console.error('Error cargando los datos:', error));
  }

  /*
  *Mostrar los datos cargados
   */
  function mostrarDatos() {
    const lista = document.getElementById('listaDatos');
    lista.innerHTML = ''; // Limpiar la lista antes de mostrar los nuevos datos

    datosSensor.forEach(item => {
      const li = document.createElement('li');
      li.textContent = JSON.stringify(item);
      lista.appendChild(li);
    });
  }

  /*
  *Modificar un valor en los datos
   */
  function modificarValor() {
    const id = document.getElementById('idSensor').value;
    const nuevoValor = parseFloat(document.getElementById('nuevoValor').value);

    const sensor = datosSensor.find(item => item.id == id);
    if (sensor) {
      //Buscar la clave para actualizar el valor (excluyendo 'id')
      for (let key in sensor) {
        if (key !== 'id') {
          sensor[key] = nuevoValor;
          break;
        }
      }
      alert(`Valor del sensor ID ${id} modificado`);
      mostrarDatos(); //Actualizar la visualizaci√≥n
    } else {
      alert('Sensor no encontrado');
    }
  }
</script>

</body>
</html>
